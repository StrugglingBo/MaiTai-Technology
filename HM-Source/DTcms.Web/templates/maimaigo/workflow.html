<!doctype html>
<html style="font-size: 60px;">
<head>
    <meta charset="utf-8">
    <!-- uc强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <!-- QQ强制竖屏 -->
    <meta name="x5-orientation" content="portrait">
    <meta name="viewport" content="width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>工单提交-麦买购</title>
    <!-- Bootstrap -->
    <link href="<%templateskin%>/css/animate.css" rel="stylesheet">
    <link href="<%templateskin%>/css/bootstrap.min.css" rel="stylesheet">
    <link href="<%templateskin%>/css/base.css" rel="stylesheet" type="text/css">
    <link href="<%templateskin%>/css/usercenter.css" rel="stylesheet" type="text/css">
    <link href="<%templateskin%>/css/city-picker.css" rel="stylesheet" type="text/css" />
    <link href="<%templateskin%>/css/easydropdown.css" rel="stylesheet" type="text/css" />
    <link href="<%templateskin%>/js/skin/layer.css" rel="stylesheet" type="text/css" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="<%templateskin%>/js/jquery.min.js"></script>
    <script src="/scripts/jquery/jquery.form.min.js" type="text/javascript"></script>
    <script src="<%templateskin%>/js/ajaxfileupload.js"></script>
    <script src="<%templateskin%>/js/bootstrap.min.js"></script>
    <script src="<%templateskin%>/js/layer.js"></script>
    <script>
        $(function () {
            //var ue = UE.getEditor('editor');
            $("input[type=file]").change(function () {
                saveimg(this.id);
            });
        });
        function saveimg(obj) {
            //利用ajax保存图片，并赋值给i+obj src 地址
            $("#i" + obj).attr("src", "<%templateskin%>/images/uploading.gif");
            $.ajaxFileUpload({
                url: '/api/appfun.ashx?action=saveimg&fname=' + obj, //用于文件上传的服务器端请求地址
                secureuri: false, //一般设置为false
                fileElementId: obj, //文件上传控件的id属性  <input type="file" id="upload" name="upload" />
                dataType: 'json', //返回值类型 一般设置为json
                success: function (data, status)  //服务器成功响应处理函数
                {
                    if (data.status == "1") {
                        var sw = screen.width;
                        //alert(data.message);//从服务器返回的json中取出message中的数据,其中message为在struts2中action中定义的成员变量
                        $("#i" + obj).attr("src", data.fileName);
                        $("#i" + obj).attr("style", "border:none;height:" + (sw * 0.3 - 5) + "px;");
                        $("#f" + obj).val(data.fileName);
                        $("#" + obj).change(function () {
                            saveimg(obj);
                        });
                    }
                    else {
                        $("#i" + obj).attr("src", "<%templateskin%>/images/icon-plus.png");
                        alert(data.msg);
                    }
                },
                error: function (data, status, e)//服务器响应失败处理函数
                {
                    $("#i" + obj).attr("src", "<%templateskin%>/images/icon-plus.png");
                    alert(e);
                }
            });
        }
        function uploadimg(obj) {
            $("#" + obj).click();
        }
        function saveactive() {
            //个人信息
            var username = $("#txtuname").val();
            var content = $("#txtcontent").val();
            if (username != "" && content != "") {
                $("#publish_form").ajaxSubmit({
                    beforeSubmit: formRequest,
                    success: formResponse,
                    error: formError,
                    url: $("#publish_form").attr("url"),
                    type: "post",
                    dataType: "json",
                    timeout: 60000
                });
            }
            else {
                layer.open({ content: "请填写工单内容后提交", time: 2 });
            }
        }
        //表单提交前
        function formRequest(formData, jqForm, options) {
            layer.open({ content: "工单提交中...", time: 1 });
        }
        //表单提交后
        function formResponse(data, textStatus) {
            if (data.status == 1) {
                //是否提示，默认不提示
                if (data.url) {
                    layer.open({ content: data.msg, time:2000 });
                    setTimeout(function () {
                        location.href = data.url;
                    }, 2000);
                }
            } else {
                layer.open({ content: data.msg, time: 2 });
            }
        }
        //表单提交出错
        function formError(XMLHttpRequest, textStatus, errorThrown) {
            layer.open({ content: '状态：' + textStatus + '；出错提示：' + errorThrown, time: 2 });
        }
    </script>
</head>
<body>
    <div id="pageContainer">
        <div class="top-bar">
            <a href="<%linkurl("usercenter")%>" class="back"></a><span class="title">工单提交</span>
        </div>
        <form id="publish_form" name="publish_form" method="post" url="{config.webpath}api/appfun.ashx?action=activepublish">
        <div class="common-wrapper">
            <div class="uc-form">
                <form class="form-inline">
                <div class="item item-input">
                    <label>
                        用户账号：</label>
                    <input id="txtuname" name="txtuname" class="txt-input" type="num" value="{userModel.user_name}"
                        readonly="readonly">
                </div>
                <div class="item item-input">
                    <label>
                        工单分类：</label>
                    <select id="txttypename" name="txttypename" class="txt-select">
                        <%if({orderno}!="")%>
                        <option value="订单相关" selected="selected">订单相关</option>
                          <option value="资金退款">资金退款</option>
                        <%else%>
                        <option value="账号相关" selected="selected">账号相关</option>
                        <option value="其它问题">其它问题</option>
                        <%/if%>
                    </select>
                </div>
               
                <div class="item item-input">
                    <label>
                        订单编号：</label>
                    <input id="txtorderno" name="txtorderno" class="txt-input" type="num" value="{orderno}" readonly=readonly>
                </div>
               
                <div class="title">
                    工单描述</div>
                <div class="content">
                    <textarea id="txtcontent" name="txtcontent" cols="" rows="" placeholder="请尽量详细描述您的问题，便于我们为您处理！如是订单问题，请通过我的订单提交工单！"></textarea></div>
                <div class="title">
                    相关凭证</div>
                <div class="content">
                    <div style="display: none;">
                        <input name="demo1" type="file" id="demo1" />
                        <input name="fdemo1" type="hidden" id="fdemo1" />
                        <input name="demo2" type="file" id="demo2" />
                        <input name="fdemo2" type="hidden" id="fdemo2" />
                        <input name="demo3" type="file" id="demo3" />
                        <input name="fdemo3" type="hidden" id="fdemo3" />
                    </div>
                    <a href="javascript:;" class="upload-btn" onclick="uploadimg('demo1')">
                        <img id="idemo1" src="<%templateskin%>/images/icon-plus.png"></a> <a href="javascript:;"
                            class="upload-btn" onclick="uploadimg('demo2')">
                            <img id="idemo2" src="<%templateskin%>/images/icon-plus.png"></a> <a href="javascript:;"
                                class="upload-btn" onclick="uploadimg('demo3')">
                                <img id="idemo3" src="<%templateskin%>/images/icon-plus.png"></a>
                </div>
                <div class="item item-btns">
                    <a class="btn-confirm" href="javascript:;" onclick="saveactive()">立即提交</a>
                </div>
                </form>
                <input type="hidden" id="turl" value="<%linkurl("usercenter")%>" />
            </div>
        </div>
        </form>
    </div>
</body>
</html>

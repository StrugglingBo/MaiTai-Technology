<!doctype html>
<html style="font-size: 60px;">
<head>
    <meta charset="utf-8">
    <!-- uc强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <!-- QQ强制竖屏 -->
    <meta name="x5-orientation" content="portrait">
    <meta name="viewport" content="width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>我的收货地址-麦买购</title>
    <!-- Bootstrap -->
    <link href="<%templateskin%>/css/animate.css" rel="stylesheet">
    <link href="<%templateskin%>/css/bootstrap.min.css" rel="stylesheet">
    <link href="<%templateskin%>/css/base.css" rel="stylesheet" type="text/css">
    <link href="<%templateskin%>/css/usercenter.css" rel="stylesheet" type="text/css">
    <link href="<%templateskin%>/css/city-picker.css" rel="stylesheet" type="text/css" />
    <link href="<%templateskin%>/js/skin/layer.css" rel="stylesheet" type="text/css" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="<%templateskin%>/js/jquery.min.js"></script>
    <script src="<%templateskin%>/js/bootstrap.min.js"></script>
    <script src="<%templateskin%>/js/city-picker.data.js"></script>
    <script src="<%templateskin%>/js/city-picker.js"></script>
    <script src="<%templateskin%>/js/jquery.dropkick-min.js"></script>
    <script src="<%templateskin%>/js/layer.js"></script>
    <script src="<%templateskin%>/js/common.js"></script>
    <script>
        $(function () {
            var $citypicker3 = $('#city-picker3');
            var pp="浙江省";
            var ct="杭州市";
            var dt="滨江区";
           <%if({addrmodel}!=null)%>
            var addr="{addrmodel.area}";
            var arr = addr.split(',');
                pp=arr[0];
                ct=arr[1];
                dt=arr[2];
            <%/if%>
            $citypicker3.citypicker({
                level:"district",
                province: pp,
                city: ct,
                district: dt
            });
        });
        function save_address(){
            var acceptname=$("#txtAcceptName").val();
            var mobile=$("#txtMobile").val();
            var pca=$("#city-picker3").val();
            var province="";
            var city="";
            var area="";
            if(pca!=""){
                var arr = pca.split('/');
                 if (arr.length > 1) {
                province=arr[0];
                city=arr[1];
                area=arr[2];
                }
                    else {
                        layer.open({
                            content: "请选择寄送地址所在区域！",
                            time: 2000
                        });
                        return false;
                    }
            }
            var address=$("#txtAddress").val();
            var userid=$("#uid").val();
            var baseurl = '/api/appfun.ashx?action=address_save&uid='+userid+'&acceptname='+encodeURI(acceptname)+'&province='+encodeURI(province)+'&city='+encodeURI(city)+'&area='+encodeURI(area)+'&address='+encodeURI(address)+'&mobile='+mobile;
            $(".btn-confirm").html("新地址添加中...");
            $(".btn-confirm").attr("disabled","disabled");
            if(acceptname!="" && mobile!=""){
            $.ajax({
                url: baseurl,
                type: 'GET',
                dataType: 'json',
                timeout: '5000',
                cache: 'false',
                success: function (data) {
                    if (data.success == "true") {
                        layer.open({
                                    content: data.msg,
                                    time: 2000
                                });
                                setTimeout(function () {
                                    var turl = data.url;
                                    if (turl != "") {
                                        if (typeof (data.url) == "undefined") {
                                            location.href = $("#turl").val();
                                        } else {
                                            location.href = data.url;
                                        }
                                    }
                                }, 2500);
                    } else {
                        layer.open({
                            content: data.msg,
                            time: 2000
                        });
                        location.href = $("#turl").val();
                    }
                }
            });
            }
            else
            {
                 layer.open({
                            content: '请填写完整后再添加',
                            time: 2000
                        });
                        window.location.reload();
            }
        }
        function ExecPostBack(checkValue) {
            ExecDelete('{config.webpath}tools/submit_ajax.ashx?action=user_address_delete', checkValue, '#turl');
        }
    </script>
</head>
<body>
    <input type="hidden" id="turl" value="<%linkurl("useraddress")%>" />
    <input type="hidden" id="uid" value="{userModel.id}" />
    <div id="pageContainer">
        <div class="top-bar">
            <a href="<%linkurl("usercenter")%>" class="back"></a><span class="title">我的收货地址</span>
        </div>
        <form id="editForm" name="editForm" url="{config.webpath}tools/submit_ajax.ashx?action=user_address_edit">
        <div class="common-wrapper">
            <div class="uc-form">
                <form class="form-inline">
                <div class="item item-tips">
                    为确保及时送货，请如实填写收货地址！！</div>
                <div class="item item-input">
                    <label>
                        收货人：</label><input name="txtAcceptName" id="txtAcceptName" class="txt-input" type="text"
                            placeholder="请输入收货人">
                </div>
                <div class="item item-input">
                    <label>
                        联系电话：</label><input name="txtMobile" id="txtMobile" class="txt-input" type="text"
                            placeholder="请输入收货人手机号">
                </div>
                <div class="item item-input">
                    <label>
                        省/市/区：</label><div id="distpicker" style="padding-left: 95px;">
                            <div style="position: relative;">
                                <input id="city-picker3" name="city-picker3" class="form-control" readonly type="text"
                                    data-toggle="city-picker3">
                            </div>
                        </div>
                </div>
                <div class="item  item-input">
                    <label>
                        详细地址：</label><input name="txtAddress" id="txtAddress" class="txt-input" type="text"
                            placeholder="请输入详细地址">
                </div>
                <div class="item item-btns">
                    <a href="javascript:;" onclick="save_address()" class="btn-confirm">添加新地址</a>
                </div>
                </form>
            </div>
            <div class="address-list">
                <%set DataTable list=get_user_addr_book_list(15, page, "user_id="+userModel.id, out totalcount)%><!--取得一个DataTable-->
                <%set string pagelist=get_page_link(15, page, totalcount, "useraddress", "__id__")%>
                <!--取得分页页码列表-->
                <%foreach(DataRow dr in list.Rows)%>
                <div class="items">
                    <div class="item-lcol">
                        <div class="item">
                            <div class="fl">
                                {dr[accept_name]}
                            </div>
                        </div>
                        <div class="item">
                            <div class="fl">
                                <%if({dr[telphone]}!="")%>
                                {dr[telphone]}<%else%>
                                {dr[mobile]}<%/if%>
                            </div>
                        </div>
                        <div class="item">
                            <div class="fl">
                                {dr[area]}
                            </div>
                        </div>
                        <div class="item">
                            <div class="fl">
                                {dr[address]}
                            </div>
                        </div>
                    </div>
                    <div class="item-rcol">
                        <div class="extra">
                            <%if({dr[is_default]}=="0")%><a onclick="clickSubmit('{config.webpath}tools/submit_ajax.ashx?action=user_address_default&id={dr[id]}')"
                                href="javascript:;">设为默认</a><%else%>
                            已默认
                            <%/if%><a href="javascript:;" onclick="ExecPostBack({dr[id]});">删除</a></div>
                    </div>
                </div>
                <%/foreach%>
            </div>
        </div>
    </div>
</body>
</html>

<!doctype html>
<html style="font-size: 60px;">
<head>
    <meta charset="utf-8">
    <!-- uc强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <!-- QQ强制竖屏 -->
    <meta name="x5-orientation" content="portrait">
    <meta name="viewport" content="width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>麦买购</title>
    <!-- Bootstrap -->
    <link href="<%templateskin%>/css/animate.css" rel="stylesheet">
    <link href="<%templateskin%>/css/base.css" rel="stylesheet">
    <link href="<%templateskin%>/css/bootstrap.min.css" rel="stylesheet">
    <link href="<%templateskin%>/css/charge.css" rel="stylesheet" type="text/css">
    <link href="<%templateskin%>/js/skin/layer.css" rel="stylesheet" type="text/css" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="<%templateskin%>/js/jquery.min.js"></script>
    <script src="<%templateskin%>/js/bootstrap.min.js"></script>
    <script src="<%templateskin%>/js/common.js" type="text/javascript"></script>
    <script src="<%templateskin%>/js/layer.js" type="text/javascript"></script>
    <script>
        function gotourl(objurl) {
            window.location.href = objurl;
        }
    </script>
    <%if(action=="confirm")%>
    <script>
        function showinfo() {
            layer.open({
                content: "<font style='text-align:center;'>订单下单成功<br/>请在15分钟内支付!</font>",
                time: 5000
            });
        }
    </script>
    <%/if%>
</head>
<%if(action=="confirm")%>
<body onload="showinfo()">
    <%else%>
    <body>
        <%/if%>
        <div id="pageContainer">
            <div class="charge">
                <div class="top-front">
                    <a href="<%linkurl("order_list")%>" class="back"></a>
                    <div class="slogan">
                        <%if(action=="confirm")%>
                        支付订单确认
                        <%/if%>
                        <%if(action=="succeed")%>
                        支付成功
                        <%/if%>
                        <%if(action=="error")%>
                        支付失败
                        <%/if%>
                    </div>
                    <div class="login">
                        <a href="<%linkurl("usercenter")%>"></a>
                    </div>
                </div>
                <div class="charge-bd">
                    <div class="order">
                        <%if(action=="confirm")%>
                        <!--确认订单-->
                        <!-- <form id="payForm" name="payForm" method="post" action="{config.webpath}api/payment/{payModel.api_path}/index.aspx"
                    target="_blank">-->
                        <input id="pay_order_no" name="pay_order_no" type="hidden" value="{orderModel.order_no}" />
                        <input id="pay_order_amount" name="pay_order_amount" type="hidden" value="{orderModel.order_amount}" />
                        <input id="pay_user_name" name="pay_user_name" type="hidden" value="{userModel.user_name}" />
                        <%if(order_type=="buygoods")%>
                        <input id="pay_subject" name="pay_subject" type="hidden" value="购买商品" />
                        <div class="inner-box">
                            <div class="dl-list">
                                <div class="logo">
                                    <img src="<%templateskin%>/images/logo-pay.png">
                                </div>
                                <div class="pay-info">
                                    <span class="txt1">提交订单完成，请尽快完成付款！</span> <span class="txt2">订单为您保留15分钟，请及时付款。</span>
                                </div>
                                <dl>
                                    <dt>待付金额：</dt>
                                    <dd>
                                        {orderModel.order_amount}</dd>
                                </dl>
                                <%if({strtoint({orderModel.message})}>0)%>
                                <dl>
                                    <dt>已付麦豆：</dt>
                                    <dd>
                                        {orderModel.point}</dd>
                                </dl>
                                <%/if%>
                            </div>
                        </div>
                        <%/if%>
                        <div class="paybottom">
                            <div class="order-txt">
                                订单号：{orderModel.order_no}</div>
                            <%if({orderModel.message}!="")%>
                            <div class="free-txt">
                                {orderModel.message}</div>
                            <%/if%>
                            <div class="order-btn">
                                <input id="pay" name="pay" type="button" class="btn btn-confirm" value="确认支付" />
                            </div>
                        </div>
                        <!--</form>-->
                        <!--/确认订单-->
                        <%/if%>
                        <%if(action=="succeed" || action=="success")%>
                        <!--支付成功-->
                        <div class="order">
                            <div class="info">
                                <div class="icon-success">
                                </div>
                                <div class="tip">
                                    <p class="t1">
                                        恭喜您，您的支付已经成功！</p>
                                    <p class="t2">
                                        进入<a href="<%linkurl("order_list")%>" class="link-center">订单管理</a>查看订单状态！</p>
                                </div>
                                <div style="clear: both">
                                </div>
                            </div>
                        </div>
                        <!--/支付成功-->
                        <%/if%>
                        <%if(action=="error" || action=="")%>
                        <!--支付出错-->
                        <div class="order">
                            <div class="info">
                                <div class="icon-failed">
                                </div>
                                <div class="tip">
                                    <p class="t1">
                                        您的支付发生意外错误！</p>
                                    <p class="t2">
                                        进入<a href="<%linkurl("order_list")%>" class="link-center">订单管理</a>查看订单状态,或联系官方客服审核确认订单状态！</p>
                                </div>
                                <div style="clear: both">
                                </div>
                            </div>
                        </div>
                        <!--/支付出错-->
                        <%/if%>
                    </div>
                </div>
            </div>
        </div>
    </body>
<%if(action=="confirm")%>
<input type="hidden" id="shoplisturl" value="<%linkurl("order_list")%>" />
<input type="hidden" id="chargeurl" value="/api/appfun.ashx?action=creatcharge&onum={orderModel.order_no}" />
<input type="hidden" id="wxopenid" value="{wxopenid}" />
<script type="text/javascript" src="https://one.pingxx.com/lib/pingpp_one.js"></script>
<script>
    document.addEventListener('pingpp_one_ready', function () {
        document.getElementById('pay').addEventListener('click', function () {
            var paychannel=['alipay_wap','wx_pub','upacp_wap','jdpay_wap','bfb_wap'];

            if($("#wxopenid").val()!=""){
                paychannel=['wx_pub','upacp_wap','jdpay_wap','bfb_wap'];
            }

            pingpp_one.init({
                app_id: 'app_vvbDiHvPGaH4vz1a',                     //该应用在 Ping++ 的应用 ID
                order_no: $("#pay_order_no").val(),                 //订单在商户系统中的订单号
                amount: {orderModel.order_amount},                  //订单价格，单位：人民豆 分
                // 壹收款页面上需要展示的渠道，数组，数组顺序即页面展示出的渠道的顺序
                //upmp_wap 渠道在微信内部无法使用，若用户未安装银联手机支付控件，则无法调起支付
                //channel: ['alipay_wap','wx_pub','upacp_wap','jdpay_wap','bfb_wap'],
                channel: paychannel,
                charge_url: $("#chargeurl").val(),  //商户服务端创建订单的 url
                charge_param: {},                   //(可选，用户自定义参数，若存在自定义参数则壹收款会通过 POST 方法透传给 charge_url)
                open_id: $("#wxopenid").val(),      //(可选，使用微信公众号支付时必须传入)
                debug: false                        //(可选，debug 模式下会将 charge_url 的返回结果透传回来)
            }, function (res) {
                //debug 模式下获取 charge_url 的返回结果
                if (res.debug && res.chargeUrlOutput) {
                    console.log(res.chargeUrlOutput);
                }
                if (!res.status) {
                    //处理错误
                    alert(res.msg);
                }
                else {
                    //debug 模式下调用 charge_url 后会暂停，可以调用 pingpp_one.resume 方法继续执行
                    if (res.debug && !res.wxSuccess) {
                        //if (confirm('当前为 debug 模式，是否继续支付？')) {
                            pingpp_one.resume();
                        //}
                    }
                    //若微信公众号渠道需要使用壹收款的支付成功页面，则在这里进行成功回调，
                    //调用 pingpp_one.success 方法，你也可以自己定义回调函数
                    //其他渠道的处理方法请见第 2 节
                    else pingpp_one.success(function (res) {
                        if (!res.status) {
                            alert(res.msg);
                        }
                    }, function () {
                        //这里处理支付成功页面点击“继续购物”按钮触发的方法，
                        //例如：若你需要点击“继续购物”按钮跳转到你的购买页，
                        //则在该方法内写入 window.location.href = "你的购买页面 url"
                        //window.location.href = $("#shoplisturl").val(); //示例
                         window.location.href=$("#shoplisturl").val();
                    });
                }
            });
        });
    });
</script>
<%/if%>
</html>
